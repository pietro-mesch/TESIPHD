\chapter{A Real-Time Forecast-Based Optimiser} \label{c:optimiser}

The foremost aim of this work is to exploit the versatility and speed of advanced macroscopic traffic simulation to bring forth a heuristic approach capable of improving signal plans \emph{in real time}.
In this, it represents an attempt to bring together the best of most signal setting approaches described so far:
\begin{description}
\item[adaptive] aiming at real-time operation, it is hoped it might guarantee a degree of adaptivity so far only expected of \todo{adaptive online signal setting approaches described in ref?? using much simpler models}
\item[accurate] \todo{comprehensive model including real time data and less dependant on single sensors (see balmanual in case it says anything interesting about the stability of optima}
\item[heuristic] using heuristics avoid the simplifications required to formulate analytical approaches without compromising on accuracy in evaluating the outcomes
\item[gating] by evaluating forecast traffic conditions over a look-ahead window, it should behave more like a feedback controller, accounting at least for the short-term consequences of its decisions.
\todo{it should stay away from greedy solutions that may maximise the immediate efficiency of junctions while disregarding even the short-term effects which might include an increase in congestion}
\end{description}

This chapter presents the approach in detail.
\todo{anticipate sections better}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Heuristic Offset Optimisation}
Describe the task at hand, in terms of inputs and goals of the optimiser strictly.

\fig{htbp}{PIX/undoguy.png}{f:run}{The basic task is to find optimum offset values that minimise a performance index calculated over }{width=0.4\textwidth}

\subsection{The Look-Ahead Window}
It could be done static, like everybody else, but we are in real time and we want to include short term effects (long term is still out of reach).

The size of the time window is limited by computing power. Resolution cannot be sacrificed or the fundamental events get averaged out.

\section{TRE as Performance Function}
Describe the interface with TRE, which is used evaluate solutions while serving as single point of contact with Optima.

\fig{htbp}{PIX/undoguy.png}{f:trega}{ Interaction between the optimiser and TRE}{width=0.4\textwidth}

Condizioni dei test di TRE:
\begin{enumerate}
\item TRE fa un equilibrio e produce TPRB per tutto il giorno: gli intervalli sono ben pi√π lunghi di un ciclo di semaforo quindi le svolte sono mediate e dipendono solo da domanda e green share
\item TRE salva l'istantanea dei flussi per cominciare le simulazioni di ottimizzazione a rete carica
\item Gli offset vengono modificati e per ogni individuo si fa un caricamento al secondo su una finestra temporale ristretta, partendo dall'istantanea salvata
\end{enumerate}

\subsection{Network Wide DTA}
Spans the next time window for the entire network calculating average splitting rates (more than reasonable) which will be used by DNL, flow snapshot and cordon link flows.

\subsection{Solution Evaluation with DNL}
Solutions are implemented and KPI calculated.

\subsection{Calling Method and Data Exchange}
The data that needs to be passed between processes is very very little:
\begin{itemize}
\item opt - TRE 1 integer
\item TRE - OPT corridor data
\item opt - TRE solutions (a bunch of numbers: nothing)
\item TRE - OPT fitness values
\end{itemize}
and can be packaged to minimise connections.

\section{Performance and Scalability}
Identify the performance bottlenecks and the most time consuming tasks.

Cite our article on parallel DTA and stress how the time hungry stuff is done only once.
Quick performance calculations to show we're well in the ballpark.

Explain how parallel machines running TRE on the same model can be used to
\begin{itemize}
\item run multiple corridors
\item evaluate more solutions in parallel complex problem space e.g. offsets+shares
\item break up a slower problem like area optimisation
\end{itemize}

\fig{htbp}{PIX/undoguy.png}{f:parallel}{Parallelisation Options}{width=0.4\textwidth}
