\chapter{The Benchmark}
\todo{This chapter introduces the Genetic Optimiser currently shipped with many OPTIMA systems, which will used as a sparring partner to evaluate the performance of the TRE based optimiser.}

\begin{itemize}
\item Il modello è meglio o peggio di TRE ?
\item Perché usare TRE che è molto più lento?
\item come funziona BAL e cosa può fare?
\end{itemize}

Balance ha un modellino \emph{mesoscopico} tipo gltm (n realtà è proprio come GLTM al secondo) e fa un taglio delle reti intorno alle junction che vuole controllare. Sugli ingressi alle sottoreti (una per ogni junction) usa profili di flusso costanti, ma se può usa i flussi uscenti di una junction per determinare i flussi entranti in una a valle (propagazione).

Il modello viene usato per ricavare le funzioni di costo FERMATE, LUNGHEZZA CODE (in realtà numero di veh in coda) e PERDITEMPO.
Lui vede le code come F-E perché i suoi archi sono in realtà le corsie di svolta, ed usa una lunghezza MASSIMA per le code.

Punti di forza di Balance:
\begin{itemize}
\item Fa tante intersezioni
\item E' veloce
\item Aggiusta anche le durate degli stage
\end{itemize}

Punti deboli:
\begin{itemize}
\item Non è detto che le intersezioni si parlino tanto bene
\item Non guarda avanti
\item non vede l'arco ma solo l'approccio: forse una volta che la coda ha raggiunto il sensore per lui tutte le situazioni sono uguali, e sotto carico non gli cambia più niente
\item Probabilmente tende a massimizzare la capacità dove è più richiesta, favorendo lo scorrimento ma provocando un comportamento "ingordo" che crea problemi a valle.
\end{itemize}

\section{Traffic Model}
Balance builds a two-level traffic model:
\begin{description}
\item[Macroscopic level]: \todo{based on OD and assignment, gives the inflow values to the junction subnetworks, runs once per optimisation window}
\item[Mesoscopic level]: \todo{second-by-second flow model, generates flow profiles based on macro flows and decision variables, computes performance indices}
\end{description}

The macroscopic model performs an incremental traffic assignment, consisting of a series of partial assignments of increasing shares of the expected traffic volumes. Each share is assigned (all-or-nothing) according to a path search that accounts for the flows already assigned, finally obtaining an estimate of the total flows on all arcs of the network, \todo{by destination???}. These may be further refined using iterative corrections if real flow measures are available.

\todo{OPTIMA may be plugged in here instead.}

The mesoscopic model begins by computing inflow profiles for each approach to a junction, determining in detail the expected dynamics of the relevant inflows over the course of a signal cycle, similarly to those described in \todo{ref scoot and formalise?} The notion of \emph{arc} in this context corresponds to that of \emph{lane group}, with the tail corresponding to the detector position (in accordance to the operational requirements specified in section \ref{s:balreq}), and the head with the signalised stop line.
The flow through the stop line is calculated by propagation of the inflow, while modelling phenomena such as \todo{platoon dispersion along the link}
\eq{e:dispersion}{
\tilde{\inflow}_{a,\tau} = \frac{1}{2L+1} \sum_{\tilde{\tau}=\tau-L}^{\tau+L} \inflow_ {a,\tilde{\tau}} \quad \text{where} \quad L=k \length_a / v_a
}
\todo{this dispersion would average anything out if tt = cycle/2}


\section{Performance Index}
For each sub-network $\arcset_j$ around a controlled junction $j$, Balance evaluates a composite performance index based on vehicle delay $D$, number of stops $S$ and queue lengths $Q$ which takes the following form:
\newcommand{\qjxj}{\mathsmaller{\mathsmaller{(\flows{j},\controlvars{j})}}}
\eq[,]{e:balancepi}{
\balpi{j}\qjxj = \sum_{a \in \bstar{j}}
\weight{a}{D} D_a\qjxj \: + \:
\weight{a}{S} S_a\qjxj \: + \:
\weight{a}{Q} Q_a\qjxj
}
where the $\weight{a}{}$ terms are arc specific weights on the value of each component performance function, while $\flows{j}$ represents a generic vector of flow values at the junction and $\controlvars{j}$ the set of decision variables. 

The delay, stops and queue terms are calculated by the mesoscopic model as detailed in the following sections.

\subsubsection*{Balance Delay $D_a$}
The delay on a lane group 

\subsubsection*{Balance Stops $S$}
The number of stops

\subsubsection*{Balance Queue Length $Q$}
Queues are

\subsubsection{Balance Requirements} \label{s:balreq}
\todo{Serve un detector con channel unico per ogni corsia interessante di approccio all'intersezione.}

If the synchronisation between signals is to be properly optimised, flow profiles must be collected on the forward star arcs of the controlled junctions in order to better estimate the arrival rates at downstream stop lines, \todo{which would otherwise be assumed constant as described in section \ref{???}}

\todo{To consider all relations between the signals and links in the network.
For this it is necessary to use the flow profiles of the links which lead out of the subnet, as
input variables for the signal groups which are located downstream. As described in chapter
2.1.4.3, the traffic flow profiles of the entry-links of a sub-net are initialized with equally
distributed profiles. If there is a traffic flow profile available for an exit-link of an adjacent}

\subsection{Balance Settings} \label{s:balset}


